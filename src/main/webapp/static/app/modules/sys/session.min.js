var $session_datagrid;var $session_search_form;$(function(){$session_search_form=$("#session_search_form").form();$session_datagrid=$("#session_datagrid").datagrid({url:ctxAdmin+"/sys/session/onLineSessions",fit:true,nowarp:false,border:false,idField:"id",pagination:true,rownumbers:true,fitColumns:false,striped:true,pageSize:20,frozenColumns:[[{field:"ck",checkbox:true}]],columns:[[{title:"ID",field:"id",width:360,hidden:true,formatter:function(b,a,c){return"<a target='_blank' href='"+ctxAdmin+"/sys/session/detail?id="+a.id+"'>"+b+"</a>"}},{title:"SessionID",field:"sessionId",width:360,hidden:false,formatter:function(b,a,c){return"<a target='_blank' href='"+ctxAdmin+"/sys/session/detail?id="+a.id+"'>"+b+"</a>"}},{title:"HOST",field:"host",width:120,hidden:true},{title:"用户类型",field:"userType",width:120,hidden:true},{title:"姓名",field:"name",width:200},{title:"登录名",field:"loginName",width:120},{title:"部门",field:"loginOrganName",width:200,hidden:true},{title:"登录IP",field:"ip",width:120,formatter:function(b,a,c){return b}},{title:"设备类型",field:"sysTemDeviceType",width:120,hidden:true},{title:"设备编码",field:"deviceCode",width:200,hidden:true},{title:"APP客户端版本",field:"appVersion",width:120,hidden:true},{title:"登录时间",field:"loginTime",width:146,formatter:function(b,a,c){return b}},{title:"最后更新时间",field:"updateTime",width:146,formatter:function(b,a,c){return b}},{title:"操作",field:"operate",width:100,formatter:function(d,c,e){var b="";var a="<a class='easyui-linkbutton' iconCls='easyui-icon-cancel'  href='#' onclick='offline("+e+");' >下线</a>";b+=a;return b}}]],toolbar:[{text:"下线",iconCls:"easyui-icon-cancel",handler:function(){offline()}}],onClickRow:function(b,a){},onLoadSuccess:function(a){$.parser.parse($(".easyui-linkbutton").parent());$(this).datagrid("clearSelections");$(this).datagrid("clearChecked");$(this).datagrid("unselectAll");$(this).datagrid("uncheckAll")}}).datagrid("showTooltip")});function offline(d){var b=new Array();var c="您确定要将选中用户强制下线？";if(d!=undefined){$session_datagrid.datagrid("unselectAll");$session_datagrid.datagrid("selectRow",d);var a=$session_datagrid.datagrid("getSelected");b.push(a);$session_datagrid.datagrid("unselectRow",d);c="您确定要将用户["+a.name+"]强制下线？"}else{b=$session_datagrid.datagrid("getChecked")}if(b.length>0){$.messager.confirm("确认提示！",c,function(f){if(f){var e=new Array();$.each(b,function(g,h){e[g]=h.id});$.ajax({url:ctxAdmin+"/sys/session/offline",type:"post",data:{sessionIds:e},traditional:true,dataType:"json",success:function(g){if(g.code==1){$session_datagrid.datagrid("load");eu.showMsg(g.msg)}else{eu.showAlertMsg(g.msg,"error")}}})}})}else{eu.showMsg("您未选择任何操作对象，请选择一行数据！")}}function search(){$session_datagrid.datagrid("load",$.serializeObject($session_search_form))};